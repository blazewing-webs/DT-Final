"use client";

import { useState } from "react";
import { collection, addDoc, Timestamp } from "firebase/firestore";
import { db } from "@/lib/firebase";
import { Loader2, CheckCircle, AlertCircle, Clock } from "lucide-react";

// Helper to create date objects
const createDate = (year: number, month: number, day: number, hour: number = 10) => {
    return new Date(year, month - 1, day, hour);
};

const SAMPLE_TIMELINE_DATA = [
    // 2025-2026 (Recent/Future)
    {
        time: "09:30 AM",
        title: "роЪроЯрпНроЯрокрпНрокрпЗро░ро╡рпИ роХрпВроЯрпНроЯродрпНродрпКроЯро░рпН родрпКроЯроЩрпНроХро┐ропродрпБ",
        description: "2026-роорпН роЖрогрпНроЯро┐ро▒рпНроХро╛рой роорпБродро▓рпН роЪроЯрпНроЯрокрпНрокрпЗро░ро╡рпИ роХрпВроЯрпНроЯродрпНродрпКроЯро░рпН роЗройрпНро▒рпБ роЖро│рпБроиро░рпН роЙро░рпИропрпБроЯройрпН родрпКроЯроЩрпНроХро┐ропродрпБ.",
        date: createDate(2026, 2, 15, 9)
    },
    {
        time: "04:15 PM",
        title: "рокрпБродро┐роп роорпЖроЯрпНро░рпЛ ро░ропро┐ро▓рпН родро┐роЯрпНроЯроорпН",
        description: "роЪрпЖройрпНройрпИ роорпЖроЯрпНро░рпЛ 2-роорпН роХроЯрпНроЯрокрпН рокрогро┐роХро│рпН: рокрпБродро┐роп ро╡ро┤ро┐родрпНродроЯроЩрпНроХро│рпБроХрпНроХрпБ роородрпНродро┐роп роЕро░роЪрпБ роТрокрпНрокрпБродро▓рпН.",
        date: createDate(2026, 1, 28, 16)
    },
    {
        time: "11:00 AM",
        title: "рокрпКроЩрпНроХро▓рпН рокро░ро┐роЪрпБродрпН родрпКроХрпБрокрпНрокрпБ роЕро▒ро┐ро╡ро┐рокрпНрокрпБ",
        description: "роЕройрпИродрпНродрпБ ро░рпЗро╖ройрпН роЕроЯрпНроЯрпИродро╛ро░ро░рпНроХро│рпБроХрпНроХрпБроорпН рокрпКроЩрпНроХро▓рпН рокро░ро┐роЪрпБродрпН родрпКроХрпБрокрпНрокрпБ ро╡ро┤роЩрпНроХрокрпНрокроЯрпБроорпН роОройрпНро▒рпБ роорпБродро▓рпНро╡ро░рпН роЕро▒ро┐ро╡ро┐рокрпНрокрпБ.",
        date: createDate(2026, 1, 5, 11)
    },
    {
        time: "10:00 AM",
        title: "роЙро▓роХродрпН роорпБродро▓рпАроЯрпНроЯро╛ро│ро░рпНроХро│рпН рооро╛роиро╛роЯрпБ",
        description: "роЪрпЖройрпНройрпИропро┐ро▓рпН роироЯрпИрокрпЖро▒рпБроорпН роЙро▓роХ роорпБродро▓рпАроЯрпНроЯро╛ро│ро░рпНроХро│рпН рооро╛роиро╛роЯрпНроЯро┐ро▓рпН ро░рпВ.5 ро▓роЯрпНроЪроорпН роХрпЛроЯро┐роХрпНроХрпБ роТрокрпНрокроирпНродроЩрпНроХро│рпН роХрпИропрпЖро┤рпБродрпНродрпБ.",
        date: createDate(2025, 12, 10, 10)
    },

    // 2024
    {
        time: "02:00 PM",
        title: "роиро╛роЯро╛ро│рпБрооройрпНро▒родрпН родрпЗро░рпНродро▓рпН роорпБроЯро┐ро╡рпБроХро│рпН",
        description: "родрооро┐ро┤роХродрпНродро┐ро▓рпН роорпКродрпНродроорпБро│рпНро│ 39 родрпКроХрпБродро┐роХро│ро┐ро▓рпБроорпН роХрпВроЯрпНроЯрогро┐ роХроЯрпНроЪро┐роХро│рпН роЕроорпЛроХ ро╡рпЖро▒рпНро▒ро┐.",
        date: createDate(2024, 6, 4, 14)
    },
    {
        time: "01:30 PM",
        title: "роХро▓рпИроЮро░рпН роирпВро▒рпНро▒ро╛рогрпНроЯрпБ роирпВро▓роХроорпН родро┐ро▒рокрпНрокрпБ",
        description: "роородрпБро░рпИропро┐ро▓рпН роХро▓рпИроЮро░рпН роирпВро▒рпНро▒ро╛рогрпНроЯрпБ роирпВро▓роХродрпНродрпИ роорпБродро▓рпНро╡ро░рпН родро┐ро▒роирпНродрпБ ро╡рпИродрпНродро╛ро░рпН. родрпЖройрпН родрооро┐ро┤роХродрпНродро┐ройрпН роЕро▒ро┐ро╡рпБроЪрпН роЪрпБро░роЩрпНроХрооро╛роХ роЗродрпБ родро┐роХро┤рпБроорпН.",
        date: createDate(2024, 1, 15, 13)
    },

    // 2023
    {
        time: "11:45 AM",
        title: "роороХро│ро┐ро░рпН роЙро░ро┐роорпИродрпН родрпКроХрпИ родро┐роЯрпНроЯроорпН родрпБро╡роХрпНроХроорпН",
        description: "рокрпЗро░ро▒ро┐роЮро░рпН роЕрогрпНрогро╛ рокро┐ро▒роирпНродроиро╛ро│ро╛рой роЗройрпНро▒рпБ, роХро▓рпИроЮро░рпН роороХро│ро┐ро░рпН роЙро░ро┐роорпИродрпН родрпКроХрпИ родро┐роЯрпНроЯродрпНродрпИ роорпБродро▓рпНро╡ро░рпН родрпКроЯроЩрпНроХро┐ ро╡рпИродрпНродро╛ро░рпН.",
        date: createDate(2023, 9, 15, 11)
    },
    {
        time: "06:00 PM",
        title: "роЪроирпНродро┐ро░ропро╛ройрпН-3 ро╡рпЖро▒рпНро▒ро┐",
        description: "роиро┐ро▓ро╡ро┐ройрпН родрпЖройрпН родрпБро░рпБро╡родрпНродро┐ро▓рпН родро░рпИропро┐ро▒роЩрпНроХро┐ропродрпБ роЪроирпНродро┐ро░ропро╛ройрпН-3. роЗро╕рпНро░рпЛ ро╡ро┐роЮрпНроЮро╛ройро┐роХро│рпБроХрпНроХрпБ роорпБродро▓рпНро╡ро░рпН рокро╛ро░ро╛роЯрпНроЯрпБ.",
        date: createDate(2023, 8, 23, 18)
    },
    {
        time: "10:30 AM",
        title: "роХрпАро┤роЯро┐ роЕро░рпБроЩрпНроХро╛роЯрпНроЪро┐ропроХроорпН родро┐ро▒рокрпНрокрпБ",
        description: "роЪро┐ро╡роХроЩрпНроХрпИ рооро╛ро╡роЯрпНроЯроорпН роХрпАро┤роЯро┐ропро┐ро▓рпН роЕроорпИроХрпНроХрокрпНрокроЯрпНроЯ роЙро▓роХродрпНродро░роорпН ро╡ро╛ропрпНроирпНрод роЕро░рпБроЩрпНроХро╛роЯрпНроЪро┐ропроХроорпН рокрпКродрпБроороХрпНроХро│рпБроХрпНроХрпБ роЕро░рпНрокрпНрокрогро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ.",
        date: createDate(2023, 3, 5, 10)
    },

    // 2022
    {
        time: "05:00 PM",
        title: "роЪрпЖро╕рпН роТро▓ро┐роорпНрокро┐ропро╛роЯрпН 2022",
        description: "рооро╛рооро▓рпНро▓рокрпБро░родрпНродро┐ро▓рпН 44-ро╡родрпБ роЪрпЖро╕рпН роТро▓ро┐роорпНрокро┐ропро╛роЯрпН рокрпЛроЯрпНроЯро┐ роХрпЛро▓ро╛роХро▓рооро╛роХродрпН родрпКроЯроЩрпНроХро┐ропродрпБ.",
        date: createDate(2022, 7, 28, 17)
    },
    {
        time: "12:00 PM",
        title: "роЗро▓рпНро▓роорпН родрпЗроЯро┐роХрпН роХро▓рпНро╡ро┐ родро┐роЯрпНроЯроорпН",
        description: "роХрпКро░рпЛройро╛ рокрпЖро░рпБроирпНродрпКро▒рпНро▒ро╛ро▓рпН роПро▒рпНрокроЯрпНроЯ роХро▒рпНро▒ро▓рпН роЗроЯрпИро╡рпЖро│ро┐ропрпИроХрпН роХрпБро▒рпИроХрпНроХ 'роЗро▓рпНро▓роорпН родрпЗроЯро┐роХрпН роХро▓рпНро╡ро┐' родро┐роЯрпНроЯроорпН рооро╛роиро┐ро▓роорпН роорпБро┤рпБро╡родрпБроорпН ро╡ро┐ро░ро┐ро╡рпБрокроЯрпБродрпНродрокрпНрокроЯрпНроЯродрпБ.",
        date: createDate(2022, 1, 26, 12)
    },

    // 2021
    {
        time: "11:00 AM",
        title: "роороХрпНроХро│рпИродрпН родрпЗроЯро┐ рооро░рпБродрпНродрпБро╡роорпН",
        description: "роХро┐ро░рпБро╖рпНрогроХро┐ро░ро┐ рооро╛ро╡роЯрпНроЯродрпНродро┐ро▓рпН 'роороХрпНроХро│рпИродрпН родрпЗроЯро┐ рооро░рпБродрпНродрпБро╡роорпН' родро┐роЯрпНроЯродрпНродрпИ роорпБродро▓рпНро╡ро░рпН родрпКроЯроЩрпНроХро┐ ро╡рпИродрпНродро╛ро░рпН.",
        date: createDate(2021, 8, 5, 11)
    },
    {
        time: "10:00 AM",
        title: "рокрпБродро┐роп роЕро░роЪрпБ рокродро╡ро┐ропрпЗро▒рпНрокрпБ",
        description: "роЪроЯрпНроЯрооройрпНро▒родрпН родрпЗро░рпНродро▓ро┐ро▓рпН ро╡рпЖро▒рпНро▒ро┐ рокрпЖро▒рпНро▒родрпИродрпН родрпКроЯро░рпНроирпНродрпБ, родро┐ро░ро╛ро╡ро┐роЯ роорпБройрпНройрпЗро▒рпНро▒роХрпН роХро┤роХроорпН роЖроЯрпНроЪро┐ропроорпИродрпНродродрпБ. роорпБродрпНродрпБро╡рпЗро▓рпН роХро░рпБрогро╛роиро┐родро┐ ро╕рпНроЯро╛ро▓ро┐ройрпН роорпБродро▓рпНро╡ро░ро╛роХрокрпН рокродро╡ро┐ропрпЗро▒рпНро▒ро╛ро░рпН.",
        date: createDate(2021, 5, 7, 10)
    }
];

export default function TimelineSeedPage() {
    const [status, setStatus] = useState<"idle" | "seeding" | "success" | "error">("idle");
    const [log, setLog] = useState<string[]>([]);

    const seedTimeline = async () => {
        if (!confirm("This will add sample timeline data. Continue?")) return;

        setStatus("seeding");
        setLog([]);

        try {
            for (const item of SAMPLE_TIMELINE_DATA) {
                setLog(prev => [...prev, `Creating: ${item.title}...`]);

                await addDoc(collection(db, "timelines"), {
                    time: item.time,
                    title: item.title,
                    description: item.description,
                    createdAt: Timestamp.fromDate(item.date) // Use historical dates
                });

                setLog(prev => [...prev, `тЬЕ Created: ${item.title}`]);
            }
            setStatus("success");
            setLog(prev => [...prev, "ЁЯОЙ All timeline events seeded successfully!"]);
        } catch (error) {
            console.error(error);
            setStatus("error");
            setLog(prev => [...prev, `тЭМ Error: ${error}`]);
        }
    };

    return (
        <div className="min-h-screen p-8 bg-neutral-50 font-sans">
            <div className="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow">
                <h1 className="text-2xl font-bold mb-6">Timeline Seeder (Tamil History)</h1>

                <div className="mb-8 p-4 bg-blue-50 text-blue-800 rounded-lg border border-blue-200 flex items-start gap-3">
                    <Clock className="w-5 h-5 mt-0.5" />
                    <p className="text-sm">
                        This tool will add {SAMPLE_TIMELINE_DATA.length} historical timeline events (2021-2026) to Firestore to test the feed.
                    </p>
                </div>

                <div className="flex gap-4 mb-8">
                    <button
                        onClick={seedTimeline}
                        disabled={status === "seeding" || status === "success"}
                        className="px-6 py-3 bg-neutral-900 text-white font-bold rounded-lg hover:bg-neutral-800 transition-colors disabled:opacity-50 flex items-center gap-2"
                    >
                        {status === "seeding" && <Loader2 className="w-4 h-4 animate-spin" />}
                        {status === "success" && <CheckCircle className="w-4 h-4" />}
                        {status === "idle" ? "Seed Timeline Data" : status === "seeding" ? "Seeding..." : "Seeding Complete"}
                    </button>

                    <a href="/" className="px-6 py-3 border border-neutral-300 rounded-lg hover:bg-neutral-50 flex items-center justify-center">
                        Go to Homepage
                    </a>
                </div>

                <div className="bg-neutral-900 text-green-400 p-4 rounded-lg font-mono text-sm h-64 overflow-y-auto">
                    {log.length === 0 ? (
                        <span className="text-neutral-500">// Logs will appear here...</span>
                    ) : (
                        log.map((line, i) => <div key={i}>{line}</div>)
                    )}
                </div>
            </div>
        </div>
    );
}
